<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>QU·∫¢N L√ù ƒê∆†N H√ÄNG | HUY STORE</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <style>
        :root { --primary: #e44d26; --dark: #1a1a1a; --light: #f4f7f6; --success: #27ae60; }
        body { font-family: 'Oswald', sans-serif; background: var(--light); padding: 20px; }
        .admin-box { max-width: 1200px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--dark); color: white; padding: 25px; border-radius: 8px; border-left: 5px solid var(--primary); position: relative; }
        .stat-card h3 { margin: 0; font-size: 14px; text-transform: uppercase; opacity: 0.7; }
        .stat-card p { margin: 10px 0 0; font-size: 32px; color: var(--primary); font-weight: bold; }

        /* Style cho t·ª´ng nh√≥m ng√†y */
        .day-group { margin-bottom: 40px; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; background: #fff; }
        .day-header { background: #333; color: #fff; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
        .day-header h2 { margin: 0; font-size: 18px; letter-spacing: 1px; }
        .day-total { color: #ffeb3b; font-weight: bold; font-size: 1.2rem; }

        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; background: white; }
        th { background: #f8f9fa; color: #333; padding: 12px 15px; text-align: left; font-size: 13px; border-bottom: 2px solid #eee; }
        td { padding: 15px; border-bottom: 1px solid #eee; vertical-align: top; font-size: 14px; }
        
        .shift-badge { padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; color: white; margin-bottom: 5px; display: inline-block; }
        .price-tag { color: var(--primary); font-weight: bold; }
        .btn-delete { background: none; border: none; color: #ccc; cursor: pointer; font-size: 18px; transition: 0.3s; }
        .btn-delete:hover { color: red; }
        .empty-state { text-align: center; padding: 50px; color: #999; }
    </style>
</head>
<body>
    <div class="admin-box">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
            <div>
                <h1 style="margin: 0; letter-spacing: 2px;">B√ÅO C√ÅO H·ªÜ TH·ªêNG HUY STORE</h1>
                <p style="margin: 0; color: #888; font-size: 14px;">D·ªØ li·ªáu doanh thu chia theo t·ª´ng ng√†y</p>
            </div>
            <div style="display: flex; gap: 10px;">
                <button onclick="clearAllData()" style="background: #333; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 12px;">X√ìA T·∫§T C·∫¢</button>
                <a href="index.html" style="text-decoration: none; color: var(--dark); font-weight: bold; border: 2px solid var(--dark); padding: 8px 20px; border-radius: 5px;">‚Üê V·ªÄ C·ª¨A H√ÄNG</a>
            </div>
        </div>

        <div class="dashboard">
            <div class="stat-card">
                <h3>T·ªïng doanh thu (M·ªçi l√∫c)</h3>
                <p id="totalRevenue">0‚Ç´</p>
            </div>
            <div class="stat-card">
                <h3>S·ªë ƒë∆°n h√†ng</h3>
                <p id="totalOrders">0</p>
            </div>
            <div class="stat-card" style="border-left-color: var(--success);">
                <h3>S·∫£n ph·∫©m ƒë√£ b√°n</h3>
                <p id="totalItems" style="color: var(--success);">0</p>
            </div>
        </div>

        <div id="historyContent">
            </div>

        <div id="emptyMessage" class="empty-state" style="display: none;">
            <i class='bx bx-receipt' style="font-size: 50px;"></i>
            <p>Ch∆∞a c√≥ giao d·ªãch n√†o ƒë∆∞·ª£c ghi nh·∫≠n.</p>
        </div>
    </div>

    <script>
        function renderAdmin() {
            let orders = JSON.parse(localStorage.getItem('orderHistory')) || [];
            const container = document.getElementById('historyContent');
            const emptyMessage = document.getElementById('emptyMessage');
            
            if (orders.length === 0) {
                container.innerHTML = '';
                emptyMessage.style.display = 'block';
                updateStats(0, 0, 0);
                return;
            }
            emptyMessage.style.display = 'none';

            // 1. T√≠nh to√°n th·ªëng k√™ t·ªïng
            let totalRev = 0;
            let totalItm = 0;
            orders.forEach(o => {
                totalRev += parseInt(o.totalAmount.replace(/[^0-9]/g, '')) || 0;
                if(o.items) o.items.forEach(i => totalItm += i.quantity);
            });
            updateStats(totalRev, orders.length, totalItm);

            // 2. Nh√≥m ƒë∆°n h√†ng theo ng√†y
            const groups = orders.reduce((groups, order) => {
                const date = order.date;
                if (!groups[date]) groups[date] = [];
                groups[date].push(order);
                return groups;
            }, {});

            // 3. S·∫Øp x·∫øp ng√†y m·ªõi nh·∫•t l√™n ƒë·∫ßu
            const sortedDates = Object.keys(groups).sort((a, b) => {
                return new Date(b.split('/').reverse().join('-')) - new Date(a.split('/').reverse().join('-'));
            });

            // 4. Hi·ªÉn th·ªã theo t·ª´ng kh·ªëi ng√†y
            container.innerHTML = sortedDates.map(date => {
                let dayTotal = 0;
                const rows = groups[date].slice().reverse().map(order => {
                    dayTotal += parseInt(order.totalAmount.replace(/[^0-9]/g, '')) || 0;
                    const shiftColor = order.shift === "S√ÅNG" ? "#ffa000" : (order.shift === "CHI·ªÄU" ? "#1976d2" : "#4527a0");
                    
                    return `
                        <tr>
                            <td style="width: 150px;">
                                <strong>${order.time}</strong><br>
                                <small style="color: #999;">ID: #${order.id}</small>
                            </td>
                            <td style="width: 200px;">
                                <span class="shift-badge" style="background:${shiftColor}"> ${order.shift || '?' }</span><br>
                                <strong>${(order.customer || 'Kh√°ch l·∫ª').toUpperCase()}</strong><br>
                                <small>${order.phone || ''}</small>
                            </td>
                            <td>
                                ${order.items ? order.items.map(i => `<div>‚Ä¢ ${i.name} (x${i.quantity})</div>`).join('') : ''}
                            </td>
                            <td class="price-tag" style="width: 150px; text-align: right;">${order.totalAmount}</td>
                            <td style="width: 50px; text-align: center;">
                                <button class="btn-delete" onclick="deleteOrder(${order.id})">&times;</button>
                            </td>
                        </tr>
                    `;
                }).join('');

                return `
                    <div class="day-group">
                        <div class="day-header">
                            <h2>üìÖ NG√ÄY ${date}</h2>
                            <span class="day-total">T·ªîNG: ${dayTotal.toLocaleString()}‚Ç´</span>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>TH·ªúI GIAN</th>
                                        <th>KH√ÅCH H√ÄNG</th>
                                        <th>CHI TI·∫æT ƒê∆†N H√ÄNG</th>
                                        <th style="text-align: right;">DOANH THU</th>
                                        <th>X√ìA</th>
                                    </tr>
                                </thead>
                                <tbody>${rows}</tbody>
                            </table>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateStats(rev, count, items) {
            document.getElementById('totalRevenue').innerText = rev.toLocaleString('vi-VN') + '‚Ç´';
            document.getElementById('totalOrders').innerText = count;
            document.getElementById('totalItems').innerText = items;
        }

        function deleteOrder(id) {
            if(confirm('X√≥a ƒë∆°n h√†ng n√†y?')) {
                let orders = JSON.parse(localStorage.getItem('orderHistory')) || [];
                orders = orders.filter(o => o.id !== id);
                localStorage.setItem('orderHistory', JSON.stringify(orders));
                renderAdmin();
            }
        }

        function clearAllData() {
            if(confirm('C·∫¢NH B√ÅO: X√≥a s·∫°ch to√†n b·ªô l·ªãch s·ª≠ doanh thu?')) {
                localStorage.removeItem('orderHistory');
                renderAdmin();
            }
        }

        window.onload = renderAdmin;
    </script>
</body>
</html>